<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>問い合わせ</title>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
</head>
<body>
<h1>コメント欄</h1>
<p>名前の欄には何も入力しない事で匿名としてコメントできます<br />このフォームはまだ開発中です(永遠に)</p>
<form onsubmit="return submitForm();">
<label>名前</label>
<input type="text" id="name" placeholder="名前を入れてね"><br>
<label>コメント内容</label>
<input type="text" id="naiyou" placeholder="コメント内容を送信"><br>
<button type="submit">送信</button>
</form>
<ul id="comments"></ul>

<!-- 管理者システム -->
<h2>管理者システム</h2>
<label>パスワード</label>
<input type="password" id="password" placeholder="パスワードを入力"><br>
<button onclick="login();">ログイン</button><br>
<button onclick="deleteAllComments();">全てのコメントを削除</button>

<p><a href="../index.html">ホームへ</a></p>

<script>
  // Firebase設定
  
  // Firebase初期化
  firebase.initializeApp(firebaseConfig);

  var db = firebase.database();
  var ref = db.ref("/comments");

  // ログイン処理
  function login() {
    var password = document.getElementById("password").value;
    if (password === 'admin_password') { // 管理者パスワードを設定
      alert('ログイン成功');
    } else {
      alert('パスワードが間違っています');
    }
  }

  // コメントを送信する
  function submitForm() {
    var name = document.getElementById("name").value;
    var naiyou = document.getElementById("naiyou").value;
    ref.push({
      name: name,
      comment: naiyou,
      time: new Date().getTime()
    });
    return false;
  }

  // コメントをリアルタイムで取得し、表示する
  ref.on("child_added", function(snapshot) {
    var data = snapshot.val();
    var name = data.name;
    var comment = data.comment;
    var li = document.createElement("li");
    li.id = snapshot.key; // 各コメントに一意のIDを設定
    li.innerText = name + ": " + comment;
    
    // 削除ボタンを作成し、各コメントに追加
    var deleteButton = document.createElement("button");
    deleteButton.innerText = "削除";
    deleteButton.onclick = function() {
      deleteComment(snapshot.key);
    };
    
    li.appendChild(deleteButton);
    
    document.getElementById("comments").appendChild(li);
  });

  // 全てのコメントを削除する関数
  function deleteAllComments() {
    ref.remove();
  }

  // 特定のコメントを削除する関数
  function deleteComment(id) {
    ref.child(id).remove();
  }
  
</script>

</body>
</html>
